<<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Maintainability (Lognormal PDF)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
*, *::before, *::after { box-sizing: border-box; }

body{
  font-family: Arial, system-ui, sans-serif;
  margin: 20px;
  background: #fff;
  color:#000;
}

/* ===== FULL WIDTH CARDS ===== */
.card{
  background:#F2F2F2;
  border:1px solid #e2e2e2;
  border-radius:14px;
  padding:22px 24px;
  margin:16px 0;
  width:100%;
}

h3{ margin:0 0 16px 0; font-size:1.1rem; font-weight:700; }

label{ font-weight:600; margin-top:12px; display:block; }

textarea, select, input{
  width:100%;
  padding:11px 12px;
  border-radius:8px;
  border:1px solid #d0d0d0;
  margin-top:6px;
  background:#fff;
}

.row{ display:flex; gap:12px; margin-top:12px; }

.actions{ display:flex; gap:10px; margin-top:14px; }

button{
  background:#000;
  color:#fff;
  border:1px solid #000;
  border-radius:10px;
  padding:10px 16px;
  font-weight:700;
  cursor:pointer;
}
button:hover{ opacity:.9; }

.tabs{ display:flex; gap:8px; margin-top:16px; }

.tabs button{
  background:#fff;
  color:#000;
  border:1px solid #000;
  border-radius:999px;
  padding:8px 14px;
  font-weight:700;
}
.tabs button.active{ background:#000; color:#fff; }

.result{ margin-top:12px; font-weight:700; }

.chart-wrap{
  margin-top:14px;
  background:#fff;
  border:1px solid #e2e2e2;
  border-radius:10px;
  padding:10px;
  height:360px;
}
.chart-wrap canvas{
  width:100%!important;
  height:100%!important;
  display:block;
}
</style>
</head>

<body>

<!-- ================= INPUTS ================= -->
<div class="card">
  <h3>Maintainability – Lognormal Analysis</h3>

  <label>Time to Repair Values</label>
  <textarea id="dataInput" rows="4" placeholder="e.g. 5, 7, 8, 10, 12, 15"></textarea>

  <div class="row">
    <div style="flex:1">
      <label>Units</label>
      <select id="units">
        <option value="hours">Hours</option>
        <option value="minutes">Minutes</option>
      </select>
    </div>

    <div style="flex:1">
      <label>Histogram Mode</label>
      <select id="binMode">
        <option value="bins">Number of Bins</option>
        <option value="width">Bin Width</option>
      </select>
    </div>

    <div style="flex:1">
      <label>Value</label>
      <input type="number" id="binValue" placeholder="e.g. 10 or 2.5">
    </div>
  </div>

  <div class="actions">
    <button id="analyzeBtn">Calculate</button>
    <button id="clearBtn">Clear Data</button>
  </div>

  <div id="summary" class="result"></div>
</div>

<!-- ================= RESULTS & PLOTS ================= -->
<div class="card">
  <h3>Results & Plots</h3>

  <div class="tabs">
    <button class="active" data-target="histWrap">Histogram</button>
    <button data-target="pdfWrap">Maintainability PDF</button>
  </div>

  <div id="histWrap" class="chart-wrap">
    <canvas id="hist"></canvas>
  </div>

  <div id="pdfWrap" class="chart-wrap" style="display:none;">
    <canvas id="pdf"></canvas>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

Chart.defaults.maintainAspectRatio=false;
Chart.defaults.elements.point.radius=0;

const $=id=>document.getElementById(id);

const histChart=new Chart($("hist"),{
  type:"bar",
  data:{labels:[],datasets:[{data:[],backgroundColor:"#000"}]},
  options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
});

const pdfChart=new Chart($("pdf"),{
  type:"line",
  data:{datasets:[{data:[],borderColor:"#000",borderWidth:2}]},
  options:{parsing:false,plugins:{legend:{display:false}},
    scales:{
      x:{type:"linear",title:{display:true,text:"Repair Time"}},
      y:{title:{display:true,text:"Probability Density f(t)"},beginAtZero:true}
    }}
});

function parseData(){
  return ($("dataInput").value||"")
    .split(/[\s,]+/).map(Number).filter(v=>v>0);
}
const mean=a=>a.reduce((s,v)=>s+v,0)/a.length;
const stdev=a=>{const m=mean(a);return Math.sqrt(a.reduce((s,v)=>s+(v-m)**2,0)/(a.length-1));};

function showTab(id){
  $("histWrap").style.display=id==="histWrap"?"block":"none";
  $("pdfWrap").style.display=id==="pdfWrap"?"block":"none";
  requestAnimationFrame(()=>{
    if(id==="histWrap"){histChart.resize();histChart.update();}
    if(id==="pdfWrap"){pdfChart.resize();pdfChart.update();}
  });
}

document.querySelectorAll(".tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    showTab(b.dataset.target);
  };
});

$("analyzeBtn").onclick=()=>{
  const data=parseData().sort((a,b)=>a-b);
  if(data.length<3){alert("Enter at least 3 values");return;}

  const ln=data.map(Math.log);
  const mu=mean(ln);
  const sigma=Math.max(stdev(ln),1e-12);

  $("summary").textContent=
    `n=${data.length} | μ=${mu.toFixed(4)} | σ=${sigma.toFixed(4)} | MTTR=${Math.exp(mu+0.5*sigma*sigma).toFixed(2)} ${$("units").value}`;

  const min=data[0], max=data[data.length-1];
  let bins=10, width;

  const mode=$("binMode").value;
  const val=parseFloat($("binValue").value);

  if(mode==="bins" && val>0){ bins=Math.round(val); width=(max-min)/bins; }
  else if(mode==="width" && val>0){ width=val; bins=Math.ceil((max-min)/width); }
  else{ bins=10; width=(max-min)/bins; }

  const counts=Array(bins).fill(0);
  data.forEach(v=>{
    let i=Math.floor((v-min)/width);
    if(i>=bins)i=bins-1;
    counts[i]++;
  });

  histChart.data.labels=counts.map((_,i)=>{
    const a=min+i*width,b=a+width;
    return `${a.toFixed(1)}–${b.toFixed(1)}`;
  });
  histChart.data.datasets[0].data=counts;
  histChart.update();

  const X=[],Y=[],hi=max*1.3;
  for(let i=0;i<320;i++){
    const t=hi*i/319;
    const pdf=t>0?(1/(t*sigma*Math.sqrt(2*Math.PI)))*Math.exp(-((Math.log(t)-mu)**2)/(2*sigma*sigma)):0;
    X.push(t);Y.push(pdf);
  }
  pdfChart.data.datasets[0].data=X.map((x,i)=>({x,y:Y[i]}));
  pdfChart.update();

  showTab(document.querySelector(".tabs button.active").dataset.target);
};

$("clearBtn").onclick=()=>{
  $("dataInput").value="";
  $("summary").textContent="";
  histChart.data.labels=[];histChart.data.datasets[0].data=[];
  pdfChart.data.datasets[0].data=[];
  histChart.update();pdfChart.update();
  showTab("histWrap");
};

showTab("histWrap");
});
</script>
<script>
  let heightTimeout;

  function sendHeight() {
    clearTimeout(heightTimeout);
    heightTimeout = setTimeout(() => {
      const height = document.documentElement.scrollHeight;
      window.parent.postMessage({ height }, "*");
    }, 50);
  }

  window.addEventListener("load", sendHeight);
  window.addEventListener("resize", sendHeight);

  const observer = new MutationObserver(sendHeight);
  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true
  });
</script>
</body>
</html>

